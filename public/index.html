<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="assets/libs/bootstrap/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="assets/libs/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="assets/libs/bootstrap-material-design/css/bootstrap-material-design.min.css" type="text/css">
    <link rel="stylesheet" href="assets/libs/bootstrap-material-design/css/ripples.min.css" type="text/css">
    <link rel="stylesheet" href="assets/libs/animate/animate.css" type="text/css">
    <link rel="stylesheet" href="assets/css/vib.css" type="text/css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/icon?family=Material+Icons">
    <script type="text/javascript" src="assets/libs/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="assets/libs/angularjs/angular.min.js"></script>
    <script type="text/javascript" src="assets/libs/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/libs/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js"></script>
    <script type="text/javascript" src="assets/libs/bootstrap-material-design/js/material.min.js"></script>
    <script type="text/javascript" src="assets/libs/bootstrap-material-design/js/ripples.min.js"></script>
    <script type="text/javascript" src="assets/libs/spinjs/spin.min.js"></script>
    <script type="text/javascript" src="assets/libs/polyfills/object.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/libs/igv.js/igv-1.0.7.css">
    <script type="text/javascript" src="assets/libs/igv.js/igv-1.0.7.js"></script>

    <script type="text/javascript" src="app/app.module.js"></script>
    <script type="text/javascript" src="app/components/ucsc/ucsc.js"></script>
    <script type="text/javascript" src="app/components/offcanvas/offcanvas.js"></script>
    <script type="text/javascript" src="app/components/visualization/visualization.js"></script>
    <script type="text/javascript" src="assets/libs/d3/d3-v4.2.0-alt.js"></script>
    <script type="text/javascript" src="assets/libs/randomColor/randomColor.js"></script>
    <script type="text/javascript" src="assets/libs/modernizr/modernizr.js"></script>
    <script type="text/javascript" src="assets/libs/md5/md5.js"></script>
    <title>
        ToucanJS
    </title>
</head>
<body data-ng-app="ToucanJS" data-ng-controller="AppController as ctrl">
    <div id="indicatorDB" ng-show="DBRequests > 0">
        <i class="animated infinite pulse material-icons red" title="Database in use. Running {{DBRequests}} transactions.">save</i>
    </div>
    <div class="container" id="top">
        <div class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-warning-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="javascript:void(0)">ToucanJS</a>
                </div>
                <div class="navbar-collapse collapse navbar-warning-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a class="pointer" data-toggle="modal" data-target="#uploadModal">Upload</a></li>
                        <li><a class="pointer" data-toggle="offcanvas" data-target="#filesOffcanvas">Files</a></li>
                        <li><a class="pointer" data-toggle="offcanvas" data-target="#sequencesOffcanvas">Regions</a></li>
                        <li><a class="pointer" data-toggle="offcanvas" data-target="#featuresOffcanvas">Features</a></li>
                        <li><a class="pointer" data-toggle="offcanvas" data-target="#searchOffcanvas">Search</a></li>
                        <li><a class="pointer" data-toggle="offcanvas" data-target="#optionsOffcanvas">Options</a></li>
                        <li><a class="pointer" data-ng-click="ctrl.clearWorkspace()">Clear</a></li>
                        <li><a class="pointer" data-toggle="modal" data-target="#aboutModal">About</a></li>
                        <!--
                        <li class="dropdown">
                            <a href="bootstrap-elements.html" data-target="#" class="dropdown-toggle pointer" data-toggle="dropdown">Menu <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li class="divider"></li>
                            </ul>
                        </li>
                        -->
                    </ul>
                </div>
            </div>
        </div>
        <div id="something"></div>
        <div class="alert alert-warning text-center" data-ng-if="notSupported()">
            You are using an <strong>unsupported browser</strong>. Please switch to recent version of either <strong>Chrome, Firefox, Edge, Opera or Safari</strong>.
        </div>
        <div class="offcanvas-wrapper">
            <div class="col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-body" id="homePanel">
                        <div class="text-center">
                            <span data-ng-if="workspace.loading">
                                <span id="spinLoading" class="spin">Loading</span> your workspace
                            </span>
                            <span data-ng-if="!workspace.loading && workspace.sequencesLength == 0">
                                Your workspace is empty. Please upload a file.
                            </span>
                            <span data-ng-if="!workspace.loading && workspace.sequencesLength != 0">
                                Loaded {{workspace.sequenceFeaturesLength}} features for {{workspace.sequencesLength}} regions from {{workspace.filesLength}} files
                                <a class="pointer pull-right" title="Cut regions" data-ng-click="ctrl.cutSequencesStart()" ng-class="{hiddenFeature: !cut.cutting}"><i class="material-icons">content_cut</i></a>
                            </span>
                        </div>
                        <visualization data-ng-show="workspace.sequencesLength != 0" options="options" workspace="workspace" search="search" move="move" cut="cut">
                        </visualization>
                    </div>
                </div>
            </div>
            <offcanvas id="filesOffcanvas">
                <div class="panel panel-primary">
                    <div class="panel-body" style="height: {{options.height+50}}px">
                        <h5><b>Files</b></h5>
                        <ul>
                            <li data-ng-repeat="file in workspace.files">
                                <span class="">{{file.name}}</span>
                                <span class="pull-right">
                                    <a class="featureToggle pointer" ng-class="{hiddenFeature: !file.show}" title="Hide / show features from this file" data-ng-click="ctrl.toggleFile(file)"><i class="material-icons">remove_red_eye</i></a>
                                    <a class="pointer" title="Remove this file" data-ng-click="ctrl.removeFile(file.ID)"><i class="material-icons">remove_circle</i></a>
                                </span>
                                <div class="clearfix"></div>
                            </li>
                        </ul>
                        <span data-ng-if="workspace.filesLength == 0">No files loaded</span>
                    </div>
                </div>
            </offcanvas>
            <offcanvas id="sequencesOffcanvas">
                <div class="panel panel-primary">
                    <div class="panel-body" style="height: {{options.height+50}}px">
                        <h5><b>Regions</b></h5>
                        <ul>
                            <li data-ng-repeat="sequence in workspace.sequences">
                                <span class="">{{sequence.seqID}}</span>
                                <span class="pull-right">
                                    <a class="featureToggle pointer" ng-class="{hiddenFeature: !sequence.show}" title="Hide / show this region" data-ng-click="ctrl.toggleSequence(sequence)"><i class="material-icons">remove_red_eye</i></a>
                                    <a class="pointer" ng-class="{hiddenFeature: !sequence.reverse}" title="Reverse compliment this sequence" data-ng-click="ctrl.reverseSequence(sequence)"><i class="material-icons">compare_arrows</i></a>
                                    <a class="pointer" title="Move this sequence" data-ng-click="ctrl.moveSequence(sequence)" ng-class="{hiddenFeature: (move.moving) && (move.seq != sequence)}"><i class="material-icons">open_with</i></a>
                                    <a class="pointer" title="Link to UCSC" data-ng-click="ctrl.linkUCSC(sequence)"><i class="material-icons">launch</i></a><a class="pointer" title="Remove this region" data-ng-click="ctrl.removeSequence(sequence.seqID)"><i class="material-icons">remove_circle</i></a>
                                </span>
                                <div class="clearfix"></div>
                            </li>
                        </ul>
                        <span data-ng-if="workspace.sequencesLength == 0">No regions loaded</span>
                    </div>
                </div>
            </offcanvas>
            <offcanvas id="featuresOffcanvas">
                <div class="panel panel-primary">
                    <div class="panel-body" style="height: {{options.height}}px">
                        <h5><b>Features</b></h5>
                        <ul>
                            <li data-ng-repeat="feature in workspace.features track by $index | orderObjectBy: 'ID'" style="color: {{feature.color}}">
                                <span class="">{{feature.ID}}</span>
                                <span class="pull-right">
                                    <a class="featureToggle pointer" ng-class="{hiddenFeature: !feature.show}" title="Hide / show this feature" data-ng-click="ctrl.toggleFeature(feature)"><i class="material-icons">remove_red_eye</i></a>
                                    <a id="color-{{escapeID(feature.ID)}}" class="featureColor pointer" ng-class="{hiddenFeature: !feature.show}" title="Color this feature" data-ng-click="ctrl.colorFeature(feature)"><i class="material-icons">invert_colors</i></a>
                                    <a class="pointer" title="Remove this feature" data-ng-click="ctrl.removeFeature(feature.ID)"><i class="material-icons">remove_circle</i></a>
                                </span>
                                <div class="clearfix"></div>
                            </li>
                        </ul>
                        <span data-ng-if="workspace.sequencesLength == 0">No features loaded</span>
                    </div>
                </div>
            </offcanvas>
            <offcanvas id="searchOffcanvas">
                <div class="panel panel-primary">
                    <div class="panel-body" style="height: {{options.height+50}}px">
                        <h5><b>Search</b></h5>
                        <form class="form-horizontal" id="searchForm" name="searchForm">
                            <fieldset>
                                <div class="form-group">
                                    <label for="file" class="col-md-4 control-label">RegExp</label>
                                    <div class="col-md-8">
                                        <input class="form-control" ng-model="search.regexp" required ng-change="ctrl.searchFeatures()" ng-disabled="workspace.sequencesLoaded == 0" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="file" class="col-md-4 control-label">Name</label>
                                    <div class="col-md-8">
                                        <input class="form-control" ng-model="search.name" required />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="file" class="col-md-4 control-label">Score</label>
                                    <div class="col-md-8">
                                        <input type="number" class="form-control" ng-model="search.score" required min="0" step="0.1" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="file" class="col-md-4 control-label">Color</label>
                                    <div id="cp2" class="input-group colorpicker-component colorpicker-hidden">
                                        <input type="text" value="#00AABB" class="form-control" required />
                                        <span class="input-group-addon"><i></i></span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <br />
                                    Available {{workspace.sequencesLoaded}} / {{workspace.sequencesLength}} DNA sequences
                                    <div ng-if="workspace.sequencesLoaded !=0 && !search.limit && !search.invalid">Found {{search.matchCount}} matches</div>
                                    <div ng-if="search.invalid" class="red">Invalid regexp</div>
                                    <div ng-if="search.limit" class="red">Search limit reached!</div>
                                    <div ng-if="workspace.sequencesLoaded == 0" class="red">No sequences available!</div>
                                    <br />
                                    <button class="btn btn-default" type="submit" ng-disabled="workspace.sequencesLoaded == 0 || search.matches == 0 || search.limit" ng-click="searchForm.$valid && ctrl.saveSearchAsFeature()">Save</button>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </offcanvas>
            <offcanvas id="optionsOffcanvas">
                <div class="panel panel-primary">
                    <div class="panel-body" style="height: {{options.height+50}}px">
                        <h5><b>Options</b></h5>
                        <form class="form-horizontal text-right">
                            <fieldset>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Visualization height</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.height' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Visualization margin</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.margin' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Context height</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.contextHeight' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Sequence name width</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.sequenceMargin' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Scale ticks</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.numberOfTicks' />
                                    </div>
                                </div>
                                <!--
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Scale stroke pattern</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" data-ng-model='options.axisStrokeArray' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Scale stroke color</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" data-ng-model='options.axisStrokeColor' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Sequence line color</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" data-ng-model='options.sequenceColor' />
                                    </div>
                                </div>
                                -->
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Sequence line width</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.sequenceWidth' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Feature height</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" class="form-control" data-ng-model='options.featureHeight' />
                                    </div>
                                </div>
                                <!--
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Feature stroke color</label>
                                    <div class="col-sm-4">
                                        <input type="text" class="form-control" data-ng-model='options.featureStrokeColor' />
                                    </div>
                                </div>
                                -->
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Feature stroke width</label>
                                    <div class="col-sm-4">
                                        <input type="number" min="0" step="0.1" class="form-control" data-ng-model='options.featureStrokeWidth' />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-8 control-label">Feature stroke opacity</label>
                                    <div class="col-sm-4">
                                        <input type="number" step="0.1" min="0" max="1" class="form-control" data-ng-model='options.featureStrokeOpacity' />
                                    </div>
                                </div>
                                <button type="button" class="btn btn-default" data-ng-click="ctrl.saveOptions()">Apply</button>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </offcanvas>
        </div>
        <!--
        <div class="navbar navbar-default">
            <div class="container-fluid">
                <ul class="nav navbar-nav navbar-left">
                    <li><a href="http://www.kuleuven.be" target="_blank"><img src="assets/img/kuleuven.png" height="40" alt="KULeuven"></a></li>
                </ul>
                <ul class="nav navbar-nav navbar-left">
                    <li><a href="http://www.vib.be" target="_blank"><img src="assets/img/vib.png" height="40" alt="VIB"></a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://www.bits.vib.be" target="_blank"><img src="assets/img/bits.png" height="40" alt="VIB Bioinformatics Core"></a></li>
                </ul>
            </div>
        </div>
        -->
    </div>
    <div class="modal fade" id="uploadModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title">Upload files</h4>
          </div>
          <div class="modal-body" ng-show="upload.assemblyDefined">
            <form class="form-horizontal" id="uploadForm">
                <fieldset>
                    <div class="form-group">
                        <label for="GFFfile" class="col-md-3 control-label"> GFF file(s)</label>
                        <div class="col-md-9">
                            <input type="text" readonly="" class="form-control" placeholder="Browse...">
                            <input type="file" id="GFFfile" name="GFFfile" multiple>
                        </div>
                    </div>
                    <!--
                    <div class="form-group">
                        <label for="BEDfile" class="col-md-3 control-label"> BED file(s)</label>
                        <div class="col-md-9">
                            <input type="text" readonly="" class="form-control" placeholder="Browse...">
                            <input type="file" id="BEDfile" name="BEDfile" multiple>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bigWigFile" class="col-md-3 control-label"> bigWig file(s)</label>
                        <div class="col-md-9">
                            <input type="text" readonly="" class="form-control" placeholder="Browse...">
                            <input type="file" id="bigWigFile" name="bigWigFile" multiple>
                        </div>
                    </div>
                    -->
                </fieldset>
            </form>
            {{message}}
          </div>
          <div class="modal-footer" ng-show="upload.assemblyDefined">
            <button type="button" class="btn btn-default" data-ng-click="ctrl.uploadFile($event)">Upload</button>
          </div>
          <div class="modal-body" ng-hide="upload.assemblyDefined">
            <form class="form-horizontal" id="assemblyForm">
                <fieldset>
                    <div class="form-group">
                        <label for="file" class="col-md-2 control-label">Assembly</label>
                        <div class="col-md-10">
                            <select class="form-control" ng-model="upload.assembly" ng-options="assembly as assembly for assembly in UCSCassemblies"></select>
                        </div>
                    </div>
                </fieldset>
            </form>
            {{message}}
          </div>
          <div class="modal-footer" ng-hide="upload.assemblyDefined">
            <button type="button" class="btn btn-default" data-ng-click="ctrl.updateAssembly()">Apply</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="aboutModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title">About ToucanJS</h4>
          </div>
          <div class="modal-body">
          <h4>Description</h4>
            TOUCAN is a workbench for regulatory sequence analysis on metazoan genomes: comparative genomics, detection of significant transcription factor binding sites, and detection of cis-regulatory modules (combinations of binding sites) in sets of coexpressed/coregulated genes. It is a platform independent, standalone web tool that is tightly linked with Ensembl, and was built using the AngularJS package. RESTful web services are used to remotely access multiple algorithms for comparative genomics, motif detection, and module detection.
            <h4>Documentation</h4>
            The manual of older versions is <a href="http://gbiomed.kuleuven.be/apps/lcb/toucan/help/index.htm">here</a>.<br />
            <h4>References</h4>
            <ul>
                <li>
                    Stein Aerts, Gert Thijs, Bert Coessens, Mik Staes, Yves Moreau, Bart De Moor (2003)<br />
                    <a href="http://nar.oupjournals.org/cgi/content/abstract/31/6/1753">TOUCAN : Deciphering the Cis-Regulatory Logic of Coregulated Genes</a><br />
                    Nucl Acids Res, vol. 31, no. 6, 2003, pp. 1753-1764.<br />
                </li>
                <li>
                    Stein Aerts, Peter Van Loo, Gert Thijs, Herbert Mayer, Rainer de Martin, Yves Moreau and Bart De Moor (2005)<br />
                    <a href="http://nar.oxfordjournals.org/cgi/content/full/33/suppl_2/W393">TOUCAN 2: the all-inclusive open source workbench for regulatory sequence analysis</a><br />
                    Nucl Acids Res, vol. 33 (Web Server issue), W393-6.
                </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="cutModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h4 class="modal-title">Restrict view</h4>
          </div>
          <div class="modal-body">
            Do you want to restrict the view to the selected region ?<br /><br />
            <fieldset>
                <div class="form-group">
                    <label for="cutStart" class="col-md-3 control-label">Start</label>
                    <div class="col-md-9">
                        <input name="cutStart" type="number" class="form-control" ng-model="cut.start" />
                    </div>
                </div>
                <div class="form-group">
                    <label for="cutStop" class="col-md-3 control-label">Stop</label>
                    <div class="col-md-9">
                        <input name="cutStop" type="number" class="form-control" ng-model="cut.end" />
                    </div>
                </div>
            </fieldset>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-ng-click="ctrl.cutSequencesDo()">Cut</button>
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
        //$.material.init();
        //$(function() {
        //});
    </script>
</body>
</html>